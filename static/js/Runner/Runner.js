// Copyright 2013-2022 The Chromium Authors & xiaohong2022
// Use of this source code is governed by a BSD-style license that can be found in the LICENSE file.

"use strict";document.addEventListener("DOMContentLoaded",function(){document.documentElement.classList.add("runner");new Runner(".interstitial-wrapper")});var mobileNav=!1;function onResize(){var a=document.querySelector("#main-content"),b=document.querySelector(".runner-container");mobileNav!==window.matchMedia("(min-width: 240px) and (max-width: 420px) and (min-height: 401px), (max-height: 560px) and (min-height: 240px) and (min-width: 421px)").matches&&((mobileNav=!mobileNav)?(a.classList.toggle("hidden",!detailsHidden),b):detailsHidden||b)}function setupMobileNav(){window.addEventListener("resize",onResize);onResize()}document.addEventListener("DOMContentLoaded",setupMobileNav);function Runner(a,b){if(Runner.instance_)return Runner.instance_;Runner.instance_=this;this.outerContainerEl=document.querySelector(a);this.touchController=this.snackbarEl=this.containerEl=null;this.config=b||Object.assign(Runner.config,Runner.normalConfig);this.dimensions=Runner.defaultDimensions;this.gameType=null;Runner.spriteDefinition=Runner.spriteDefinitionByType.original;this.altGameImageSprite=null;this.altGameModeActive=!1;this.altGameModeFlashTimer=null;this.fadeInTimer=0;this.distanceMeter=this.tRex=this.canvasCtx=this.canvas=null;this.highestScore=this.distanceRan=0;this.syncHighestScore=!1;this.runningTime=this.time=0;this.msPerFrame=1E3/FPS;this.currentSpeed=this.config.SPEED;Runner.slowDown=!1;this.obstacles=[];this.inverted=this.paused=this.crashed=this.playing=this.activated=!1;this.invertTimer=0;this.resizeTimerId_=null;this.playCount=0;this.audioBuffer=null;this.soundFx={};this.audioContext=this.generatedSoundFx=null;this.images={};this.imagesLoaded=0;this.pollingGamepads=!1;this.gamepadIndex=void 0;this.previousGamepad=null;this.isDisabled()?this.setupDisabledRunner():(Runner.isAltGameModeEnabled()&&(this.initAltGameType(),Runner.gameType=this.gameType),this.loadImages(),window.initializeEasterEggHighScore=this.initializeHighScore.bind(this))}var DEFAULT_WIDTH=600,FPS=60,IS_HIDPI=1<window.devicePixelRatio,IS_IOS=/CriOS/.test(window.navigator.userAgent),IS_MOBILE=/Android/.test(window.navigator.userAgent)||IS_IOS,IS_RTL="rtl"==document.querySelector("html").dir,ARCADE_MODE_URL="chrome://dino/",RESOURCE_POSTFIX="offline-resources-",A11Y_STRINGS={ariaLabel:"dinoGameA11yAriaLabel",description:"dinoGameA11yDescription",gameOver:"dinoGameA11yGameOver",highScore:"dinoGameA11yHighScore",jump:"dinoGameA11yJump",started:"dinoGameA11yStartGame",speedLabel:"dinoGameA11ySpeedToggle"};Runner.config={AUDIOCUE_PROXIMITY_THRESHOLD:190,AUDIOCUE_PROXIMITY_THRESHOLD_MOBILE_A11Y:250,BG_CLOUD_SPEED:.2,BOTTOM_PAD:10,CANVAS_IN_VIEW_OFFSET:-10,CLEAR_TIME:3E3,CLOUD_FREQUENCY:.5,FADE_DURATION:1,FLASH_DURATION:1E3,GAMEOVER_CLEAR_TIME:1200,INITIAL_JUMP_VELOCITY:12,INVERT_FADE_DURATION:12E3,MAX_BLINK_COUNT:3,MAX_CLOUDS:6,MAX_OBSTACLE_LENGTH:3,MAX_OBSTACLE_DUPLICATION:2,RESOURCE_TEMPLATE_ID:"audio-resources",SPEED:6,SPEED_DROP_COEFFICIENT:3,ARCADE_MODE_INITIAL_TOP_POSITION:35,ARCADE_MODE_TOP_POSITION_PERCENT:.1};Runner.normalConfig={ACCELERATION:.001,AUDIOCUE_PROXIMITY_THRESHOLD:190,AUDIOCUE_PROXIMITY_THRESHOLD_MOBILE_A11Y:250,GAP_COEFFICIENT:.6,INVERT_DISTANCE:700,MAX_SPEED:13,MOBILE_SPEED_COEFFICIENT:1.2,SPEED:6};Runner.slowConfig={ACCELERATION:5E-4,AUDIOCUE_PROXIMITY_THRESHOLD:170,AUDIOCUE_PROXIMITY_THRESHOLD_MOBILE_A11Y:220,GAP_COEFFICIENT:.3,INVERT_DISTANCE:350,MAX_SPEED:9,MOBILE_SPEED_COEFFICIENT:1.5,SPEED:4.2};Runner.defaultDimensions={WIDTH:DEFAULT_WIDTH,HEIGHT:150};Runner.classes={ARCADE_MODE:"arcade-mode",CANVAS:"runner-canvas",CONTAINER:"runner-container",CRASHED:"crashed",ICON:"icon-offline",INVERTED:"inverted",SNACKBAR:"snackbar",SNACKBAR_SHOW:"snackbar-show",TOUCH_CONTROLLER:"controller"};Runner.sounds={BUTTON_PRESS:"offline-sound-press",HIT:"offline-sound-hit",SCORE:"offline-sound-reached"};Runner.keycodes={JUMP:{38:1,32:1},DUCK:{40:1},RESTART:{13:1}};Runner.events={ANIM_END:"webkitAnimationEnd",CLICK:"click",KEYDOWN:"keydown",KEYUP:"keyup",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",RESIZE:"resize",TOUCHEND:"touchend",TOUCHSTART:"touchstart",VISIBILITY:"visibilitychange",BLUR:"blur",FOCUS:"focus",LOAD:"load",GAMEPADCONNECTED:"gamepadconnected"};Runner.prototype={initAltGameType:function(){0<GAME_TYPE.length&&(this.gameType=loadTimeData&&loadTimeData.valueExists("altGameType")?GAME_TYPE[parseInt(loadTimeData.getValue("altGameType"),10)-1]:"")},isDisabled:function(){return loadTimeData&&loadTimeData.valueExists("disabledEasterEgg")},setupDisabledRunner:function(){this.containerEl=document.createElement("div");this.containerEl.className=Runner.classes.SNACKBAR;this.containerEl.textContent=loadTimeData.getValue("disabledEasterEgg");this.outerContainerEl.appendChild(this.containerEl);document.addEventListener(Runner.events.KEYDOWN,function(a){Runner.keycodes.JUMP[a.keyCode]&&(this.containerEl.classList.add(Runner.classes.SNACKBAR_SHOW),document.querySelector(".icon").classList.add("icon-disabled"))}.bind(this))},updateConfigSetting:function(a,b){if(a in this.config&&void 0!==b)switch(this.config[a]=b,a){case "GRAVITY":case "MIN_JUMP_HEIGHT":case "SPEED_DROP_COEFFICIENT":this.tRex.config[a]=b;break;case "INITIAL_JUMP_VELOCITY":this.tRex.setJumpVelocity(b);break;case "SPEED":this.setSpeed(b)}},createImageElement:function(a){var b=loadTimeData&&loadTimeData.valueExists(a)?loadTimeData.getString(a):null;if(b){var c=document.createElement("img");c.id=a;c.src=b;document.getElementById("offline-resources").appendChild(c);return c}return null},loadImages:function(){var a="1x";this.spriteDef=Runner.spriteDefinition.LDPI;IS_HIDPI&&(a="2x",this.spriteDef=Runner.spriteDefinition.HDPI);Runner.imageSprite=document.getElementById(RESOURCE_POSTFIX+a);this.gameType&&(Runner.altGameImageSprite=this.createImageElement("altGameSpecificImage"+a),Runner.altCommonImageSprite=this.createImageElement("altGameCommonImage"+a));Runner.origImageSprite=Runner.imageSprite;Runner.altGameImageSprite&&Runner.altCommonImageSprite||(Runner.isAltGameModeEnabled=function(){return!1},this.altGameModeActive=!1);Runner.imageSprite.complete?this.init():Runner.imageSprite.addEventListener(Runner.events.LOAD,this.init.bind(this))},loadSounds:function(){if(!IS_IOS){this.audioContext=new AudioContext;var a=document.getElementById(this.config.RESOURCE_TEMPLATE_ID).content,b;for(b in Runner.sounds){var c=a.getElementById(Runner.sounds[b]).src;c=c.substr(c.indexOf(",")+1);c=decodeBase64ToArrayBuffer(c);this.audioContext.decodeAudioData(c,function(d,e){this.soundFx[d]=e}.bind(this,b))}}},setSpeed:function(a){var b=a||this.currentSpeed;this.dimensions.WIDTH<DEFAULT_WIDTH?(a=Runner.slowDown?b:b*this.dimensions.WIDTH/DEFAULT_WIDTH*this.config.MOBILE_SPEED_COEFFICIENT,this.currentSpeed=a>b?b:a):a&&(this.currentSpeed=a)},init:function(){var a=this;this.adjustDimensions();this.setSpeed();var b=getA11yString(A11Y_STRINGS.ariaLabel);this.containerEl=document.createElement("div");this.containerEl.setAttribute("role",IS_MOBILE?"button":"application");this.containerEl.setAttribute("tabindex","0");this.containerEl.setAttribute("title",b);this.containerEl.className=Runner.classes.CONTAINER;this.canvas=createCanvas(this.containerEl,this.dimensions.WIDTH,this.dimensions.HEIGHT);this.a11yStatusEl=document.createElement("span");this.a11yStatusEl.className="offline-runner-live-region";this.a11yStatusEl.setAttribute("aria-live","assertive");this.a11yStatusEl.textContent="";Runner.a11yStatusEl=this.a11yStatusEl;this.slowSpeedCheckboxLabel=document.createElement("label");this.slowSpeedCheckboxLabel.className="slow-speed-option hidden";this.slowSpeedCheckboxLabel.textContent=getA11yString(A11Y_STRINGS.speedLabel);this.slowSpeedCheckbox=document.createElement("input");this.slowSpeedCheckbox.setAttribute("type","checkbox");this.slowSpeedCheckbox.setAttribute("title",getA11yString(A11Y_STRINGS.speedLabel));this.slowSpeedCheckbox.setAttribute("tabindex","0");this.slowSpeedCheckbox.setAttribute("checked","checked");this.slowSpeedToggleEl=document.createElement("span");this.slowSpeedToggleEl.className="slow-speed-toggle";this.slowSpeedCheckboxLabel.appendChild(this.slowSpeedCheckbox);this.slowSpeedCheckboxLabel.appendChild(this.slowSpeedToggleEl);IS_IOS?this.outerContainerEl.appendChild(this.a11yStatusEl):this.containerEl.appendChild(this.a11yStatusEl);announcePhrase(getA11yString(A11Y_STRINGS.description));this.generatedSoundFx=new GeneratedSoundFx;this.canvasCtx=this.canvas.getContext("2d");this.canvasCtx.fillStyle="#f7f7f7";this.canvasCtx.fill();Runner.updateCanvasScaling(this.canvas);this.horizon=new Horizon(this.canvas,this.spriteDef,this.dimensions,this.config.GAP_COEFFICIENT);this.distanceMeter=new DistanceMeter(this.canvas,this.spriteDef.TEXT_SPRITE,this.dimensions.WIDTH);this.tRex=new Trex(this.canvas,this.spriteDef.TREX);this.outerContainerEl.appendChild(this.containerEl);this.outerContainerEl.appendChild(this.slowSpeedCheckboxLabel);this.startListening();this.update();window.addEventListener(Runner.events.RESIZE,this.debounceResize.bind(this));this.isDarkMode=(b=window.matchMedia("(prefers-color-scheme: dark)"))&&b.matches;b.addListener(function(c){a.isDarkMode=c.matches})},createTouchController:function(){this.touchController=document.createElement("div");this.touchController.className=Runner.classes.TOUCH_CONTROLLER;this.touchController.addEventListener(Runner.events.TOUCHSTART,this);this.touchController.addEventListener(Runner.events.TOUCHEND,this);this.outerContainerEl.appendChild(this.touchController)},debounceResize:function(){this.resizeTimerId_||(this.resizeTimerId_=setInterval(this.adjustDimensions.bind(this),250))},adjustDimensions:function(){clearInterval(this.resizeTimerId_);this.resizeTimerId_=null;var a=window.getComputedStyle(this.outerContainerEl);a=Number(a.paddingLeft.substr(0,a.paddingLeft.length-2));this.dimensions.WIDTH=this.outerContainerEl.offsetWidth-2*a;this.isArcadeMode()&&(this.dimensions.WIDTH=Math.min(DEFAULT_WIDTH,this.dimensions.WIDTH),this.activated&&this.setArcadeModeContainerScale());this.canvas&&(this.canvas.width=this.dimensions.WIDTH,this.canvas.height=this.dimensions.HEIGHT,Runner.updateCanvasScaling(this.canvas),this.distanceMeter.calcXPos(this.dimensions.WIDTH),this.clearCanvas(),this.horizon.update(0,0,!0),this.tRex.update(0),this.playing||this.crashed||this.paused?(this.containerEl.style.width=this.dimensions.WIDTH+"px",this.containerEl.style.height=this.dimensions.HEIGHT+"px",this.distanceMeter.update(0,Math.ceil(this.distanceRan)),this.stop()):this.tRex.draw(0,0),this.crashed&&this.gameOverPanel&&(this.gameOverPanel.updateDimensions(this.dimensions.WIDTH),this.gameOverPanel.draw(this.altGameModeActive,this.tRex)))},playIntro:function(){this.activated||this.crashed?this.crashed&&this.restart():(this.playingIntro=!0,this.tRex.playingIntro=!0,document.styleSheets[0].insertRule("@-webkit-keyframes intro { from { width:"+Trex.config.WIDTH+"px }to { width: "+this.dimensions.WIDTH+"px }}",0),this.containerEl.addEventListener(Runner.events.ANIM_END,this.startGame.bind(this)),this.containerEl.style.webkitAnimation="intro .4s ease-out 1 both",this.containerEl.style.width=this.dimensions.WIDTH+"px",this.setPlayStatus(!0),this.activated=!0)},startGame:function(){this.isArcadeMode()&&this.setArcadeMode();this.toggleSpeed();this.runningTime=0;this.playingIntro=!1;this.tRex.playingIntro=!1;this.containerEl.style.webkitAnimation="";this.playCount++;this.generatedSoundFx.background();announcePhrase(getA11yString(A11Y_STRINGS.started));Runner.audioCues&&this.containerEl.setAttribute("title",getA11yString(A11Y_STRINGS.jump));},clearCanvas:function(){this.canvasCtx.clearRect(0,0,this.dimensions.WIDTH,this.dimensions.HEIGHT)},isCanvasInView:function(){return this.containerEl.getBoundingClientRect().top>Runner.config.CANVAS_IN_VIEW_OFFSET},enableAltGameMode:function(){Runner.imageSprite=Runner.altGameImageSprite;Runner.spriteDefinition=Runner.spriteDefinitionByType[Runner.gameType];this.spriteDef=IS_HIDPI?Runner.spriteDefinition.HDPI:Runner.spriteDefinition.LDPI;this.altGameModeActive=!0;this.tRex.enableAltGameMode(this.spriteDef.TREX);this.horizon.enableAltGameMode(this.spriteDef);this.generatedSoundFx.background()},update:function(){this.updatePending=!1;var a=getTimeStamp(),b=a-(this.time||a);0>this.altGameModeFlashTimer||0===this.altGameModeFlashTimer?(this.altGameModeFlashTimer=null,this.tRex.setFlashing(!1),this.enableAltGameMode()):0<this.altGameModeFlashTimer&&(this.altGameModeFlashTimer-=b,this.tRex.update(b),b=0);this.time=a;if(this.playing){this.clearCanvas();this.altGameModeActive&&this.fadeInTimer<=this.config.FADE_DURATION?(this.fadeInTimer+=b/1E3,this.canvasCtx.globalAlpha=this.fadeInTimer):this.canvasCtx.globalAlpha=1;this.tRex.jumping&&this.tRex.updateJump(b);this.runningTime+=b;var c=this.runningTime>this.config.CLEAR_TIME;1!==this.tRex.jumpCount||this.playingIntro||this.playIntro();this.playingIntro?this.horizon.update(0,this.currentSpeed,c):this.crashed||(a=this.isDarkMode^this.inverted,b=this.activated?b:0,this.horizon.update(b,this.currentSpeed,c,a));a=c&&checkForCollision(this.horizon.obstacles[0],this.tRex);if(Runner.audioCues&&c&&(c="COLLECTABLE"!=this.horizon.obstacles[0].typeConfig.type,!this.horizon.obstacles[0].jumpAlerted)){var d=Runner.isMobileMouseInput?Runner.config.AUDIOCUE_PROXIMITY_THRESHOLD_MOBILE_A11Y:Runner.config.AUDIOCUE_PROXIMITY_THRESHOLD;this.horizon.obstacles[0].xPos<d+d*Math.log10(this.currentSpeed/Runner.config.SPEED)&&(c&&this.generatedSoundFx.jump(),this.horizon.obstacles[0].jumpAlerted=!0)}Runner.isAltGameModeEnabled()&&a&&"COLLECTABLE"==this.horizon.obstacles[0].typeConfig.type&&(this.horizon.removeFirstObstacle(),this.tRex.setFlashing(!0),a=!1,this.altGameModeFlashTimer=this.config.FLASH_DURATION,this.runningTime=0,this.generatedSoundFx.collect());a?this.gameOver():(this.distanceRan+=this.currentSpeed*b/this.msPerFrame,this.currentSpeed<this.config.MAX_SPEED&&(this.currentSpeed+=this.config.ACCELERATION));a=this.distanceMeter.update(b,Math.ceil(this.distanceRan));!Runner.audioCues&&a&&this.playSound(this.soundFx.SCORE);Runner.isAltGameModeEnabled()||(this.invertTimer>this.config.INVERT_FADE_DURATION?(this.invertTimer=0,this.invertTrigger=!1,this.invert(!1)):this.invertTimer?this.invertTimer+=b:(a=this.distanceMeter.getActualDistance(Math.ceil(this.distanceRan)),0<a&&(this.invertTrigger=!(a%this.config.INVERT_DISTANCE))&&0===this.invertTimer&&(this.invertTimer+=b,this.invert(!1))))}if(this.playing||!this.activated&&this.tRex.blinkCount<Runner.config.MAX_BLINK_COUNT)this.tRex.update(b),this.scheduleNextUpdate()},handleEvent:function(a){var b=Runner.events;switch(a.type){case b.KEYDOWN:case b.TOUCHSTART:case b.POINTERDOWN:this.onKeyDown(a);break;case b.KEYUP:case b.TOUCHEND:case b.POINTERUP:this.onKeyUp(a);break;case b.GAMEPADCONNECTED:this.onGamepadConnected(a)}},handleCanvasKeyPress:function(a){if(!this.activated&&!Runner.audioCues)this.toggleSpeed(),Runner.audioCues=!0,this.generatedSoundFx.init(),Runner.generatedSoundFx=this.generatedSoundFx,Runner.config.CLEAR_TIME*=1.2;else if(a.keyCode&&Runner.keycodes.JUMP[a.keyCode])this.onKeyDown(a)},preventScrolling:function(a){32===a.keyCode&&a.preventDefault()},toggleSpeed:function(){if(Runner.audioCues){if(Runner.slowDown!=this.slowSpeedCheckbox.checked){Runner.slowDown=this.slowSpeedCheckbox.checked;var a=Runner.slowDown?Runner.slowConfig:Runner.normalConfig;Runner.config=Object.assign(Runner.config,a);this.currentSpeed=a.SPEED;this.tRex.enableSlowConfig();this.horizon.adjustObstacleSpeed()}this.playing&&this.disableSpeedToggle(!0)}},showSpeedToggle:function(a){a=a&&"focus"==a.type;(Runner.audioCues||a)&&this.slowSpeedCheckboxLabel.classList.toggle("hidden",a?!1:!this.crashed)},disableSpeedToggle:function(a){a?this.slowSpeedCheckbox.setAttribute("disabled","disabled"):this.slowSpeedCheckbox.removeAttribute("disabled")},startListening:function(){this.containerEl.addEventListener(Runner.events.KEYDOWN,this.handleCanvasKeyPress.bind(this));IS_MOBILE||this.containerEl.addEventListener(Runner.events.FOCUS,this.showSpeedToggle.bind(this));this.canvas.addEventListener(Runner.events.KEYDOWN,this.preventScrolling.bind(this));this.canvas.addEventListener(Runner.events.KEYUP,this.preventScrolling.bind(this));document.addEventListener(Runner.events.KEYDOWN,this);document.addEventListener(Runner.events.KEYUP,this);this.containerEl.addEventListener(Runner.events.TOUCHSTART,this);document.addEventListener(Runner.events.POINTERDOWN,this);document.addEventListener(Runner.events.POINTERUP,this);this.isArcadeMode()&&window.addEventListener(Runner.events.GAMEPADCONNECTED,this)},stopListening:function(){document.removeEventListener(Runner.events.KEYDOWN,this);document.removeEventListener(Runner.events.KEYUP,this);this.touchController&&(this.touchController.removeEventListener(Runner.events.TOUCHSTART,this),this.touchController.removeEventListener(Runner.events.TOUCHEND,this));this.containerEl.removeEventListener(Runner.events.TOUCHSTART,this);document.removeEventListener(Runner.events.POINTERDOWN,this);document.removeEventListener(Runner.events.POINTERUP,this);this.isArcadeMode()&&window.removeEventListener(Runner.events.GAMEPADCONNECTED,this)},onKeyDown:function(a){IS_MOBILE&&this.playing&&a.preventDefault();if(!(!this.isCanvasInView()||Runner.keycodes.JUMP[a.keyCode]&&a.target==this.slowSpeedCheckbox||this.crashed||this.paused)){var b=IS_MOBILE&&a.type===Runner.events.POINTERDOWN&&"mouse"==a.pointerType&&a.target==this.containerEl||IS_IOS&&"touch"==a.pointerType&&document.activeElement==this.containerEl;Runner.keycodes.JUMP[a.keyCode]||a.type===Runner.events.TOUCHSTART||b||Runner.keycodes.DUCK[a.keyCode]&&this.altGameModeActive?(a.preventDefault(),this.playing||(this.touchController||a.type!==Runner.events.TOUCHSTART||this.createTouchController(),b&&this.handleCanvasKeyPress(a),this.loadSounds(),this.setPlayStatus(!0),this.update()),this.tRex.jumping||this.tRex.ducking||(Runner.audioCues?this.generatedSoundFx.cancelFootSteps():this.playSound(this.soundFx.BUTTON_PRESS),this.tRex.startJump(this.currentSpeed))):!this.altGameModeActive&&this.playing&&Runner.keycodes.DUCK[a.keyCode]&&(a.preventDefault(),this.tRex.jumping?this.tRex.setSpeedDrop():this.tRex.jumping||this.tRex.ducking||this.tRex.setDuck(!0))}},onKeyUp:function(a){var b=String(a.keyCode),c=Runner.keycodes.JUMP[b]||a.type===Runner.events.TOUCHEND||a.type===Runner.events.POINTERUP;this.isRunning()&&c?this.tRex.endJump():Runner.keycodes.DUCK[b]?(this.tRex.speedDrop=!1,this.tRex.setDuck(!1)):this.crashed?(c=getTimeStamp()-this.time,this.isCanvasInView()&&(Runner.keycodes.RESTART[b]||this.isLeftClickOnCanvas(a)||c>=this.config.GAMEOVER_CLEAR_TIME&&Runner.keycodes.JUMP[b])&&this.handleGameOverClicks(a)):this.paused&&c&&(this.tRex.reset(),this.play())},onGamepadConnected:function(a){this.pollingGamepads||this.pollGamepadState()},pollGamepadState:function(){var a=navigator.getGamepads();this.pollActiveGamepad(a);this.pollingGamepads=!0;requestAnimationFrame(this.pollGamepadState.bind(this))},pollForActiveGamepad:function(a){for(var b=0;b<a.length;++b)if(a[b]&&0<a[b].buttons.length&&a[b].buttons[0].pressed){this.gamepadIndex=b;this.pollActiveGamepad(a);break}},pollActiveGamepad:function(a){if(void 0===this.gamepadIndex)this.pollForActiveGamepad(a);else{var b=a[this.gamepadIndex];b?(this.pollGamepadButton(b,0,38),2<=b.buttons.length&&this.pollGamepadButton(b,1,40),10<=b.buttons.length&&this.pollGamepadButton(b,9,13),this.previousGamepad=b):(this.gamepadIndex=void 0,this.pollForActiveGamepad(a))}},pollGamepadButton:function(a,b,c){a=a.buttons[b].pressed;var d=!1;this.previousGamepad&&(d=this.previousGamepad.buttons[b].pressed);a!==d&&(b=new KeyboardEvent(a?Runner.events.KEYDOWN:Runner.events.KEYUP,{keyCode:c}),document.dispatchEvent(b))},handleGameOverClicks:function(a){a.target!=this.slowSpeedCheckbox&&(a.preventDefault(),this.distanceMeter.hasClickedOnHighScore(a)&&this.highestScore?this.distanceMeter.isHighScoreFlashing()?(this.saveHighScore(0,!0),this.distanceMeter.resetHighScore()):this.distanceMeter.startHighScoreFlashing():(this.distanceMeter.cancelHighScoreFlashing(),this.restart()))},isLeftClickOnCanvas:function(a){return null!=a.button&&2>a.button&&a.type===Runner.events.POINTERUP&&(a.target===this.canvas||IS_MOBILE&&Runner.audioCues&&a.target===this.containerEl)},scheduleNextUpdate:function(){this.updatePending||(this.updatePending=!0,this.raqId=requestAnimationFrame(this.update.bind(this)))},isRunning:function(){return!!this.raqId},initializeHighScore:function(a){this.syncHighestScore=!0;a=Math.ceil(a);a<this.highestScore?window.errorPageController&&errorPageController.updateEasterEggHighScore(this.highestScore):(this.highestScore=a,this.distanceMeter.setHighScore(this.highestScore))},saveHighScore:function(a,b){this.highestScore=Math.ceil(a);this.distanceMeter.setHighScore(this.highestScore);this.syncHighestScore&&window.errorPageController&&(b?errorPageController.resetEasterEggHighScore():errorPageController.updateEasterEggHighScore(this.highestScore))},gameOver:function(){this.playSound(this.soundFx.HIT);vibrate(200);this.stop();this.crashed=!0;this.distanceMeter.achievement=!1;this.tRex.update(100,Trex.status.CRASHED);if(!this.gameOverPanel){var a=IS_HIDPI?Runner.spriteDefinitionByType.original.HDPI:Runner.spriteDefinitionByType.original.LDPI;this.canvas&&(this.gameOverPanel=Runner.isAltGameModeEnabled?new GameOverPanel(this.canvas,a.TEXT_SPRITE,a.RESTART,this.dimensions,a.ALT_GAME_END,this.altGameModeActive):new GameOverPanel(this.canvas,a.TEXT_SPRITE,a.RESTART,this.dimensions))}this.gameOverPanel.draw(this.altGameModeActive,this.tRex);this.distanceRan>this.highestScore&&this.saveHighScore(this.distanceRan);this.time=getTimeStamp();Runner.audioCues&&(this.generatedSoundFx.stopAll(),announcePhrase(getA11yString(A11Y_STRINGS.gameOver).replace("$1",this.distanceMeter.getActualDistance(this.distanceRan).toString())+" "+getA11yString(A11Y_STRINGS.highScore).replace("$1",this.distanceMeter.getActualDistance(this.highestScore).toString())),this.containerEl.setAttribute("title",getA11yString(A11Y_STRINGS.ariaLabel)));this.showSpeedToggle();this.disableSpeedToggle(!1)},stop:function(){this.setPlayStatus(!1);this.paused=!0;cancelAnimationFrame(this.raqId);this.raqId=0;this.generatedSoundFx.stopAll()},play:function(){this.crashed||(this.setPlayStatus(!0),this.paused=!1,this.tRex.update(0,Trex.status.RUNNING),this.time=getTimeStamp(),this.update(),this.generatedSoundFx.background())},restart:function(){this.raqId||(this.playCount++,this.runningTime=0,this.setPlayStatus(!0),this.toggleSpeed(),this.crashed=this.paused=!1,this.distanceRan=0,this.setSpeed(this.config.SPEED),this.time=getTimeStamp(),this.containerEl.classList.remove(Runner.classes.CRASHED),this.clearCanvas(),this.distanceMeter.reset(),this.horizon.reset(),this.tRex.reset(),this.playSound(this.soundFx.BUTTON_PRESS),this.invert(!0),this.flashTimer=null,this.update(),this.gameOverPanel.reset(),this.generatedSoundFx.background(),this.containerEl.setAttribute("title",getA11yString(A11Y_STRINGS.jump)),announcePhrase(getA11yString(A11Y_STRINGS.started)))},setPlayStatus:function(a){this.touchController&&this.touchController.classList.toggle("hidden",!a);this.playing=a},isArcadeMode:function(){return IS_RTL?1==document.title.indexOf(ARCADE_MODE_URL):document.title===ARCADE_MODE_URL},setArcadeMode:function(){document.body.classList.add(Runner.classes.ARCADE_MODE);this.setArcadeModeContainerScale()},setArcadeModeContainerScale:function(){var a=window.innerHeight,b=Math.max(1,Math.min(a/this.dimensions.HEIGHT,window.innerWidth/this.dimensions.WIDTH));this.containerEl.style.transform="scale("+(IS_RTL?-b+","+b:b)+") translateY("+Math.ceil(Math.max(0,(a-this.dimensions.HEIGHT*b-Runner.config.ARCADE_MODE_INITIAL_TOP_POSITION)*Runner.config.ARCADE_MODE_TOP_POSITION_PERCENT))*window.devicePixelRatio+"px)"},playSound:function(a){if(a){var b=this.audioContext.createBufferSource();b.buffer=a;b.connect(this.audioContext.destination);b.start(0)}},invert:function(a){var b=document.firstElementChild;a?(b.classList.toggle(Runner.classes.INVERTED,!1),this.invertTimer=0,this.inverted=!1):this.inverted=b.classList.toggle(Runner.classes.INVERTED,this.invertTrigger)}};Runner.updateCanvasScaling=function(a,b,c){var d=a.getContext("2d"),e=Math.floor(window.devicePixelRatio)||1,f=Math.floor(d.webkitBackingStorePixelRatio)||1,g=e/f;if(e!==f)return b=b||a.width,c=c||a.height,a.width=b*g,a.height=c*g,a.style.width=b+"px",a.style.height=c+"px",d.scale(g,g),!0;1===e&&(a.style.width=a.width+"px",a.style.height=a.height+"px");return!1};Runner.isAltGameModeEnabled=function(){return loadTimeData&&loadTimeData.valueExists("enableAltGameMode")};function GeneratedSoundFx(){this.audioCues=!1;this.panner=this.context=null}GeneratedSoundFx.prototype={init:function(){this.audioCues=!0;this.context||(this.context=window.webkitAudioContext?new webkitAudioContext:new AudioContext,IS_IOS&&(this.context.onstatechange=function(){"running"!=this.context.state&&this.context.resume()}.bind(this),this.context.resume()),this.panner=this.context.createStereoPanner?this.context.createStereoPanner():null)},stopAll:function(){this.cancelFootSteps()},playNote:function(a,b,c,d,e){var f=this.context.createOscillator(),g=this.context.createOscillator(),h=this.context.createGain();f.type="triangle";g.type="triangle";h.gain.value=.1;this.panner?(this.panner.pan.value=e||0,f.connect(h).connect(this.panner),g.connect(h).connect(this.panner),this.panner.connect(this.context.destination)):(f.connect(h),g.connect(h),h.connect(this.context.destination));f.frequency.value=a+1;g.frequency.value=a-2;h.gain.setValueAtTime(d||.01,b+c-.05);h.gain.linearRampToValueAtTime(1E-5,b+c);f.start(b);g.start(b);f.stop(b+c);g.stop(b+c)},background:function(){if(this.audioCues){var a=this.context.currentTime;this.playNote(493.883,a,.116);this.playNote(659.255,a+.116,.232);this.loopFootSteps()}},loopFootSteps:function(){this.audioCues&&!this.bgSoundIntervalId&&(this.bgSoundIntervalId=setInterval(function(){this.playNote(73.42,this.context.currentTime,.05,.16);this.playNote(69.3,this.context.currentTime+.116,.116,.16)}.bind(this),280))},cancelFootSteps:function(){this.audioCues&&this.bgSoundIntervalId&&(clearInterval(this.bgSoundIntervalId),this.bgSoundIntervalId=null,this.playNote(103.83,this.context.currentTime,.232,.02),this.playNote(116.54,this.context.currentTime+.116,.232,.02))},collect:function(){if(this.audioCues){this.cancelFootSteps();var a=this.context.currentTime;this.playNote(830.61,a,.116);this.playNote(1318.51,a+.116,.232)}},jump:function(){if(this.audioCues){var a=this.context.currentTime;this.playNote(659.25,a,.116,.3,-.6);this.playNote(880,a+.116,.232,.3,-.6)}}};function speakPhrase(a){if("speechSynthesis"in window){var b=new SpeechSynthesisUtterance(a);window.speechSynthesis.getVoices();b.text=a;speechSynthesis.speak(b)}}function announcePhrase(a){Runner.a11yStatusEl&&(Runner.a11yStatusEl.textContent=a)}function getA11yString(a){return loadTimeData&&loadTimeData.valueExists(a)?loadTimeData.getString(a):""}function getRandomNum(a,b){return Math.floor(Math.random()*(b-a+1))+a}function vibrate(a){IS_MOBILE&&window.navigator.vibrate&&window.navigator.vibrate(a)}function createCanvas(a,b,c,d){var e=document.createElement("canvas");e.className=d?Runner.classes.CANVAS+" "+d:Runner.classes.CANVAS;e.width=b;e.height=c;a.appendChild(e);return e}function decodeBase64ToArrayBuffer(a){var b=a.length/4*3;a=atob(a);var c=new ArrayBuffer(b);c=new Uint8Array(c);for(var d=0;d<b;d++)c[d]=a.charCodeAt(d);return c.buffer}function getTimeStamp(){return IS_IOS?(new Date).getTime():performance.now()}function GameOverPanel(a,b,c,d,e,f){this.canvas=a;this.canvasCtx=a.getContext("2d");this.canvasDimensions=d;this.textImgPos=b;this.restartImgPos=c;this.altGameEndImgPos=e;this.altGameModeActive=f;this.currentFrame=this.animTimer=this.frameTimeStamp=0;this.gameOverRafId=null;this.flashCounter=this.flashTimer=0;this.originalText=!0}GameOverPanel.RESTART_ANIM_DURATION=875;GameOverPanel.LOGO_PAUSE_DURATION=875;GameOverPanel.FLASH_ITERATIONS=5;GameOverPanel.animConfig={frames:[0,36,72,108,144,180,216,252],msPerFrame:GameOverPanel.RESTART_ANIM_DURATION/8};GameOverPanel.dimensions={TEXT_X:0,TEXT_Y:13,TEXT_WIDTH:191,TEXT_HEIGHT:11,RESTART_WIDTH:36,RESTART_HEIGHT:32};GameOverPanel.prototype={updateDimensions:function(a,b){this.canvasDimensions.WIDTH=a;b&&(this.canvasDimensions.HEIGHT=b);this.currentFrame=GameOverPanel.animConfig.frames.length-1},drawGameOverText:function(a,b){var c=a.TEXT_X,d=a.TEXT_Y,e=a.TEXT_WIDTH,f=a.TEXT_HEIGHT,g=Math.round(this.canvasDimensions.WIDTH/2-a.TEXT_WIDTH/2),h=Math.round((this.canvasDimensions.HEIGHT-25)/3),k=a.TEXT_WIDTH;a=a.TEXT_HEIGHT;IS_HIDPI&&(d*=2,c*=2,e*=2,f*=2);b||(c+=this.textImgPos.x,d+=this.textImgPos.y);b=b?Runner.altCommonImageSprite:Runner.origImageSprite;this.canvasCtx.save();IS_RTL&&(this.canvasCtx.translate(this.canvasDimensions.WIDTH,0),this.canvasCtx.scale(-1,1));this.canvasCtx.drawImage(b,c,d,e,f,g,h,k,a);this.canvasCtx.restore()},drawAltGameElements:function(a){if(this.altGameModeActive&&Runner.spriteDefinition.ALT_GAME_END_CONFIG){var b=Runner.spriteDefinition.ALT_GAME_END_CONFIG,c=b.WIDTH,d=b.HEIGHT,e=a.xPos+b.X_OFFSET;a=a.yPos+b.Y_OFFSET;IS_HIDPI&&(c*=2,d*=2);this.canvasCtx.drawImage(Runner.altCommonImageSprite,this.altGameEndImgPos.x,this.altGameEndImgPos.y,c,d,e,a,b.WIDTH,b.HEIGHT)}},drawRestartButton:function(){var a=GameOverPanel.dimensions,b=GameOverPanel.animConfig.frames[this.currentFrame],c=a.RESTART_WIDTH,d=a.RESTART_HEIGHT,e=this.canvasDimensions.WIDTH/2-a.RESTART_WIDTH/2,f=this.canvasDimensions.HEIGHT/2;IS_HIDPI&&(c*=2,d*=2,b*=2);this.canvasCtx.save();IS_RTL&&(this.canvasCtx.translate(this.canvasDimensions.WIDTH,0),this.canvasCtx.scale(-1,1));this.canvasCtx.drawImage(Runner.origImageSprite,this.restartImgPos.x+b,this.restartImgPos.y,c,d,e,f,a.RESTART_WIDTH,a.RESTART_HEIGHT);this.canvasCtx.restore()},draw:function(a,b){a&&(this.altGameModeActive=a);this.drawGameOverText(GameOverPanel.dimensions,!1);this.drawRestartButton();this.drawAltGameElements(b);this.update()},update:function(){var a=getTimeStamp(),b=a-(this.frameTimeStamp||a);this.frameTimeStamp=a;this.animTimer+=b;this.flashTimer+=b;if(0==this.currentFrame&&this.animTimer>GameOverPanel.LOGO_PAUSE_DURATION)this.animTimer=0,this.currentFrame++,this.drawRestartButton();else if(0<this.currentFrame&&this.currentFrame<GameOverPanel.animConfig.frames.length)this.animTimer>=GameOverPanel.animConfig.msPerFrame&&(this.currentFrame++,this.drawRestartButton());else if(!this.altGameModeActive&&this.currentFrame==GameOverPanel.animConfig.frames.length){this.reset();return}if(this.altGameModeActive&&Runner.spriteDefinitionByType.original.ALT_GAME_OVER_TEXT_CONFIG)if(a=Runner.spriteDefinitionByType.original.ALT_GAME_OVER_TEXT_CONFIG,this.flashCounter<GameOverPanel.FLASH_ITERATIONS&&this.flashTimer>a.FLASH_DURATION)this.flashTimer=0,this.originalText=!this.originalText,this.clearGameOverTextBounds(),this.originalText?(this.drawGameOverText(GameOverPanel.dimensions,!1),this.flashCounter++):this.drawGameOverText(a,!0);else if(this.flashCounter>=GameOverPanel.FLASH_ITERATIONS){this.reset();return}this.gameOverRafId=requestAnimationFrame(this.update.bind(this))},clearGameOverTextBounds:function(){this.canvasCtx.save();this.canvasCtx.clearRect(Math.round(this.canvasDimensions.WIDTH/2-GameOverPanel.dimensions.TEXT_WIDTH/2),Math.round((this.canvasDimensions.HEIGHT-25)/3),GameOverPanel.dimensions.TEXT_WIDTH,GameOverPanel.dimensions.TEXT_HEIGHT+4);this.canvasCtx.restore()},reset:function(){this.gameOverRafId&&(cancelAnimationFrame(this.gameOverRafId),this.gameOverRafId=null);this.flashCounter=this.flashTimer=this.currentFrame=this.frameTimeStamp=this.animTimer=0;this.originalText=!0}};function checkForCollision(a,b,c){var d=new CollisionBox(b.xPos+1,b.yPos+1,b.config.WIDTH-2,b.config.HEIGHT-2),e=new CollisionBox(a.xPos+1,a.yPos+1,a.typeConfig.width*a.size-2,a.typeConfig.height-2);c&&drawCollisionBoxes(c,d,e);if(boxCompare(d,e)){a=a.collisionBoxes;b=Runner.isAltGameModeEnabled()?Runner.spriteDefinition.TREX.COLLISION_BOXES:b.ducking?Trex.collisionBoxes.DUCKING:Trex.collisionBoxes.RUNNING;for(var f=0;f<b.length;f++)for(var g=0;g<a.length;g++){var h=createAdjustedCollisionBox(b[f],d),k=createAdjustedCollisionBox(a[g],e),l=boxCompare(h,k);c&&drawCollisionBoxes(c,h,k);if(l)return[h,k]}}}function createAdjustedCollisionBox(a,b){return new CollisionBox(a.x+b.x,a.y+b.y,a.width,a.height)}function drawCollisionBoxes(a,b,c){a.save();a.strokeStyle="#f00";a.strokeRect(b.x,b.y,b.width,b.height);a.strokeStyle="#0f0";a.strokeRect(c.x,c.y,c.width,c.height);a.restore()}function boxCompare(a,b){var c=!1,d=b.x;a.x<d+b.width&&a.x+a.width>d&&a.y<b.y+b.height&&a.height+a.y>b.y&&(c=!0);return c}function CollisionBox(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d}function Obstacle(a,b,c,d,e,f,g,h){this.canvasCtx=a;this.spritePos=c;this.typeConfig=b;this.gapCoefficient=Runner.slowDown?2*e:e;this.size=getRandomNum(1,Obstacle.MAX_OBSTACLE_LENGTH);this.dimensions=d;this.remove=!1;this.xPos=d.WIDTH+(g||0);this.width=this.yPos=0;this.collisionBoxes=[];this.speedOffset=this.gap=0;this.altGameModeActive=h;this.imageSprite="COLLECTABLE"==this.typeConfig.type?Runner.altCommonImageSprite:this.altGameModeActive?Runner.altGameImageSprite:Runner.imageSprite;this.timer=this.currentFrame=0;this.init(f)}Obstacle.MAX_GAP_COEFFICIENT=1.5;Obstacle.MAX_OBSTACLE_LENGTH=3;Obstacle.prototype={init:function(a){this.cloneCollisionBoxes();1<this.size&&this.typeConfig.multipleSpeed>a&&(this.size=1);this.width=this.typeConfig.width*this.size;if(Array.isArray(this.typeConfig.yPos)){var b=IS_MOBILE?this.typeConfig.yPosMobile:this.typeConfig.yPos;this.yPos=b[getRandomNum(0,b.length-1)]}else this.yPos=this.typeConfig.yPos;this.draw();1<this.size&&(this.collisionBoxes[1].width=this.width-this.collisionBoxes[0].width-this.collisionBoxes[2].width,this.collisionBoxes[2].x=this.width-this.collisionBoxes[2].width);this.typeConfig.speedOffset&&(this.speedOffset=.5<Math.random()?this.typeConfig.speedOffset:-this.typeConfig.speedOffset);this.gap=this.getGap(this.gapCoefficient,a);Runner.audioCues&&(this.gap*=2)},draw:function(){var a=this.typeConfig.width,b=this.typeConfig.height;IS_HIDPI&&(a*=2,b*=2);var c=a*this.size*.5*(this.size-1)+this.spritePos.x;0<this.currentFrame&&(c+=a*this.currentFrame);this.canvasCtx.drawImage(this.imageSprite,c,this.spritePos.y,a*this.size,b,this.xPos,this.yPos,this.typeConfig.width*this.size,this.typeConfig.height)},update:function(a,b){this.remove||(this.typeConfig.speedOffset&&(b+=this.speedOffset),this.xPos-=Math.floor(b*FPS/1E3*a),this.typeConfig.numFrames&&(this.timer+=a,this.timer>=this.typeConfig.frameRate&&(this.currentFrame=this.currentFrame===this.typeConfig.numFrames-1?0:this.currentFrame+1,this.timer=0)),this.draw(),this.isVisible()||(this.remove=!0))},getGap:function(a,b){a=Math.round(this.width*b+this.typeConfig.minGap*a);return getRandomNum(a,Math.round(a*Obstacle.MAX_GAP_COEFFICIENT))},isVisible:function(){return 0<this.xPos+this.width},cloneCollisionBoxes:function(){for(var a=this.typeConfig.collisionBoxes,b=a.length-1;0<=b;b--)this.collisionBoxes[b]=new CollisionBox(a[b].x,a[b].y,a[b].width,a[b].height)}};function Trex(a,b){this.canvas=a;this.canvasCtx=a.getContext("2d");this.spritePos=b;this.currentFrame=this.groundYPos=this.xInitialPos=this.yPos=this.xPos=0;this.currentAnimFrames=[];this.timer=this.animStartTime=this.blinkCount=this.blinkDelay=0;this.msPerFrame=1E3/FPS;this.config=Object.assign(Trex.config,Trex.normalJumpConfig);this.status=Trex.status.WAITING;this.ducking=this.jumping=!1;this.jumpVelocity=0;this.speedDrop=this.reachedMinHeight=!1;this.jumpspotX=this.jumpCount=0;this.flashing=this.altGameModeEnabled=!1;this.init()}Trex.config={DROP_VELOCITY:-5,FLASH_OFF:175,FLASH_ON:100,HEIGHT:47,HEIGHT_DUCK:25,INTRO_DURATION:1500,SPEED_DROP_COEFFICIENT:3,SPRITE_WIDTH:262,START_X_POS:50,WIDTH:44,WIDTH_DUCK:59};Trex.slowJumpConfig={GRAVITY:.25,MAX_JUMP_HEIGHT:50,MIN_JUMP_HEIGHT:45,INITIAL_JUMP_VELOCITY:-20};Trex.normalJumpConfig={GRAVITY:.6,MAX_JUMP_HEIGHT:30,MIN_JUMP_HEIGHT:30,INITIAL_JUMP_VELOCITY:-10};Trex.collisionBoxes={DUCKING:[new CollisionBox(1,18,55,25)],RUNNING:[new CollisionBox(22,0,17,16),new CollisionBox(1,18,30,9),new CollisionBox(10,35,14,8),new CollisionBox(1,24,29,5),new CollisionBox(5,30,21,4),new CollisionBox(9,34,15,4)]};Trex.status={CRASHED:"CRASHED",DUCKING:"DUCKING",JUMPING:"JUMPING",RUNNING:"RUNNING",WAITING:"WAITING"};Trex.BLINK_TIMING=7E3;Trex.animFrames={WAITING:{frames:[44,0],msPerFrame:1E3/3},RUNNING:{frames:[88,132],msPerFrame:1E3/12},CRASHED:{frames:[220],msPerFrame:1E3/60},JUMPING:{frames:[0],msPerFrame:1E3/60},DUCKING:{frames:[264,323],msPerFrame:125}};Trex.prototype={init:function(){this.yPos=this.groundYPos=Runner.defaultDimensions.HEIGHT-this.config.HEIGHT-Runner.config.BOTTOM_PAD;this.minJumpHeight=this.groundYPos-this.config.MIN_JUMP_HEIGHT;this.draw(0,0);this.update(0,Trex.status.WAITING)},enableSlowConfig:function(){Trex.config=Object.assign(Trex.config,Runner.slowDown?Trex.slowJumpConfig:Trex.normalJumpConfig);this.adjustAltGameConfigForSlowSpeed()},enableAltGameMode:function(a){this.altGameModeEnabled=!0;this.spritePos=a;a=Runner.spriteDefinition.TREX;Trex.animFrames.RUNNING.frames=[a.RUNNING_1.x,a.RUNNING_2.x];Trex.animFrames.CRASHED.frames=[a.CRASHED.x];Trex.animFrames.JUMPING.frames="object"==typeof a.JUMPING.x?a.JUMPING.x:[a.JUMPING.x];Trex.animFrames.DUCKING.frames=[a.RUNNING_1.x,a.RUNNING_2.x];Trex.config.GRAVITY=a.GRAVITY||Trex.config.GRAVITY;Trex.config.HEIGHT=a.RUNNING_1.h;Trex.config.INITIAL_JUMP_VELOCITY=a.INITIAL_JUMP_VELOCITY;Trex.config.MAX_JUMP_HEIGHT=a.MAX_JUMP_HEIGHT;Trex.config.MIN_JUMP_HEIGHT=a.MIN_JUMP_HEIGHT;Trex.config.WIDTH=a.RUNNING_1.w;Trex.config.WIDTH_JUMP=a.JUMPING.w;Trex.config.INVERT_JUMP=a.INVERT_JUMP;this.adjustAltGameConfigForSlowSpeed(a.GRAVITY);this.config=Trex.config;this.yPos=this.groundYPos=Runner.defaultDimensions.HEIGHT-this.config.HEIGHT-Runner.spriteDefinition.BOTTOM_PAD;this.reset()},adjustAltGameConfigForSlowSpeed:function(a){Runner.slowDown&&(a&&(Trex.config.GRAVITY=a/1.5),Trex.config.MIN_JUMP_HEIGHT*=1.5,Trex.config.MAX_JUMP_HEIGHT*=1.5,Trex.config.INITIAL_JUMP_VELOCITY*=1.5)},setFlashing:function(a){this.flashing=a},setJumpVelocity:function(a){this.config.INITIAL_JUMP_VELOCITY=-a;this.config.DROP_VELOCITY=-a/2},update:function(a,b){this.timer+=a;b&&(this.status=b,this.currentFrame=0,this.msPerFrame=Trex.animFrames[b].msPerFrame,this.currentAnimFrames=Trex.animFrames[b].frames,b===Trex.status.WAITING&&(this.animStartTime=getTimeStamp(),this.setBlinkDelay()));this.playingIntro&&this.xPos<this.config.START_X_POS&&(this.xInitialPos=this.xPos+=Math.round(this.config.START_X_POS/this.config.INTRO_DURATION*a));this.status===Trex.status.WAITING?this.blink(getTimeStamp()):this.draw(this.currentAnimFrames[this.currentFrame],0);!this.flashing&&this.timer>=this.msPerFrame&&(this.currentFrame=this.currentFrame==this.currentAnimFrames.length-1?0:this.currentFrame+1,this.timer=0);!this.altGameModeEnabled&&this.speedDrop&&this.yPos===this.groundYPos&&(this.speedDrop=!1,this.setDuck(!0))},draw:function(a,b){var c=this.ducking&&this.status!==Trex.status.CRASHED?this.config.WIDTH_DUCK:this.config.WIDTH,d=this.config.HEIGHT,e=d,f=Runner.spriteDefinition.TREX.JUMPING.xOffset;this.altGameModeEnabled&&this.jumping&&this.status!==Trex.status.CRASHED&&(c=this.config.WIDTH_JUMP);IS_HIDPI&&(a*=2,b*=2,c*=2,d*=2,f*=2);a+=this.spritePos.x;b+=this.spritePos.y;this.flashing&&(this.timer<this.config.FLASH_ON?this.canvasCtx.globalAlpha=.5:this.timer>this.config.FLASH_OFF&&(this.timer=0));!this.altGameModeEnabled&&this.ducking&&this.status!==Trex.status.CRASHED?this.canvasCtx.drawImage(Runner.imageSprite,a,b,c,d,this.xPos,this.yPos,this.config.WIDTH_DUCK,e):this.altGameModeEnabled&&this.jumping&&this.status!==Trex.status.CRASHED?this.canvasCtx.drawImage(Runner.imageSprite,a,b,c,d,this.xPos-f,this.yPos,this.config.WIDTH_JUMP,e):(this.ducking&&this.status===Trex.status.CRASHED&&this.xPos++,this.canvasCtx.drawImage(Runner.imageSprite,a,b,c,d,this.xPos,this.yPos,this.config.WIDTH,e));this.canvasCtx.globalAlpha=1},setBlinkDelay:function(){this.blinkDelay=Math.ceil(Math.random()*Trex.BLINK_TIMING)},blink:function(a){a-this.animStartTime>=this.blinkDelay&&(this.draw(this.currentAnimFrames[this.currentFrame],0),1===this.currentFrame&&(this.setBlinkDelay(),this.animStartTime=a,this.blinkCount++))},startJump:function(a){this.jumping||(this.update(0,Trex.status.JUMPING),this.jumpVelocity=this.config.INITIAL_JUMP_VELOCITY-a/10,this.jumping=!0,this.speedDrop=this.reachedMinHeight=!1,this.config.INVERT_JUMP&&(this.minJumpHeight=this.groundYPos+this.config.MIN_JUMP_HEIGHT))},endJump:function(){this.reachedMinHeight&&this.jumpVelocity<this.config.DROP_VELOCITY&&(this.jumpVelocity=this.config.DROP_VELOCITY)},updateJump:function(a){a/=Trex.animFrames[this.status].msPerFrame;this.yPos=this.speedDrop?this.yPos+Math.round(this.jumpVelocity*this.config.SPEED_DROP_COEFFICIENT*a):this.config.INVERT_JUMP?this.yPos-Math.round(this.jumpVelocity*a):this.yPos+Math.round(this.jumpVelocity*a);this.jumpVelocity+=this.config.GRAVITY*a;if(this.config.INVERT_JUMP&&this.yPos>this.minJumpHeight||!this.config.INVERT_JUMP&&this.yPos<this.minJumpHeight||this.speedDrop)this.reachedMinHeight=!0;(this.config.INVERT_JUMP&&this.yPos>-this.config.MAX_JUMP_HEIGHT||!this.config.INVERT_JUMP&&this.yPos<this.config.MAX_JUMP_HEIGHT||this.speedDrop)&&this.endJump();if((this.config.INVERT_JUMP&&this.yPos)<this.groundYPos||(!this.config.INVERT_JUMP&&this.yPos)>this.groundYPos)this.reset(),this.jumpCount++,Runner.audioCues&&Runner.generatedSoundFx.loopFootSteps()},setSpeedDrop:function(){this.speedDrop=!0;this.jumpVelocity=1},setDuck:function(a){a&&this.status!==Trex.status.DUCKING?(this.update(0,Trex.status.DUCKING),this.ducking=!0):this.status===Trex.status.DUCKING&&(this.update(0,Trex.status.RUNNING),this.ducking=!1)},reset:function(){this.xPos=this.xInitialPos;this.yPos=this.groundYPos;this.jumpVelocity=0;this.ducking=this.jumping=!1;this.update(0,Trex.status.RUNNING);this.speedDrop=this.midair=!1;this.jumpCount=0}};function DistanceMeter(a,b,c){this.canvas=a;this.canvasCtx=a.getContext("2d");this.image=Runner.imageSprite;this.spritePos=b;this.x=0;this.y=5;this.maxScore=this.currentDistance=0;this.highScore="0";this.container=null;this.digits=[];this.achievement=!1;this.defaultString="";this.flashIterations=this.flashTimer=0;this.invertTrigger=!1;this.flashingRafId=null;this.highScoreBounds={};this.highScoreFlashing=!1;this.config=DistanceMeter.config;this.maxScoreUnits=this.config.MAX_DISTANCE_UNITS;this.canvasWidth=c;this.init(c)}DistanceMeter.dimensions={WIDTH:10,HEIGHT:13,DEST_WIDTH:11};DistanceMeter.yPos=[0,13,27,40,53,67,80,93,107,120];DistanceMeter.config={MAX_DISTANCE_UNITS:5,ACHIEVEMENT_DISTANCE:100,COEFFICIENT:.025,FLASH_DURATION:250,FLASH_ITERATIONS:3,HIGH_SCORE_HIT_AREA_PADDING:4};DistanceMeter.prototype={init:function(a){var b="";this.calcXPos(a);this.maxScore=this.maxScoreUnits;for(a=0;a<this.maxScoreUnits;a++)this.draw(a,0),this.defaultString+="0",b+="9";this.maxScore=parseInt(b,10)},calcXPos:function(a){this.x=a-DistanceMeter.dimensions.DEST_WIDTH*(this.maxScoreUnits+1)},draw:function(a,b,c){var d=DistanceMeter.dimensions.WIDTH,e=DistanceMeter.dimensions.HEIGHT;b*=DistanceMeter.dimensions.WIDTH;var f=a*DistanceMeter.dimensions.DEST_WIDTH,g=this.y,h=DistanceMeter.dimensions.WIDTH,k=DistanceMeter.dimensions.HEIGHT;IS_HIDPI&&(d*=2,e*=2,b*=2);b+=this.spritePos.x;a=0+this.spritePos.y;this.canvasCtx.save();if(IS_RTL)c?this.canvasCtx.translate(this.canvasWidth-DistanceMeter.dimensions.WIDTH*(this.maxScoreUnits+3),this.y):this.canvasCtx.translate(this.canvasWidth-DistanceMeter.dimensions.WIDTH,this.y),this.canvasCtx.scale(-1,1);else{var l=this.x-2*this.maxScoreUnits*DistanceMeter.dimensions.WIDTH;c?this.canvasCtx.translate(l,this.y):this.canvasCtx.translate(this.x,this.y)}this.canvasCtx.drawImage(this.image,b,a,d,e,f,g,h,k);this.canvasCtx.restore()},getActualDistance:function(a){return a?Math.round(a*this.config.COEFFICIENT):0},update:function(a,b){var c=!0,d=!1;this.achievement?this.flashIterations<=this.config.FLASH_ITERATIONS?(this.flashTimer+=a,this.flashTimer<this.config.FLASH_DURATION?c=!1:this.flashTimer>2*this.config.FLASH_DURATION&&(this.flashTimer=0,this.flashIterations++)):(this.achievement=!1,this.flashTimer=this.flashIterations=0):(b=this.getActualDistance(b),b>this.maxScore&&this.maxScoreUnits==this.config.MAX_DISTANCE_UNITS?(this.maxScoreUnits++,this.maxScore=parseInt(this.maxScore+"9",10)):this.distance=0,0<b?(0===b%this.config.ACHIEVEMENT_DISTANCE&&(this.achievement=!0,this.flashTimer=0,d=!0),this.digits=(this.defaultString+b).substr(-this.maxScoreUnits).split("")):this.digits=this.defaultString.split(""));if(c)for(a=this.digits.length-1;0<=a;a--)this.draw(a,parseInt(this.digits[a],10));this.drawHighScore();return d},drawHighScore:function(){if(0<parseInt(this.highScore,10)){this.canvasCtx.save();this.canvasCtx.globalAlpha=.8;for(var a=this.highScore.length-1;0<=a;a--)this.draw(a,parseInt(this.highScore[a],10),!0);this.canvasCtx.restore()}},setHighScore:function(a){a=this.getActualDistance(a);a=(this.defaultString+a).substr(-this.maxScoreUnits);this.highScore=["10","11",""].concat(a.split(""))},hasClickedOnHighScore:function(a){if(a.touches){var b=this.canvas.getBoundingClientRect(),c=a.touches[0].clientX-b.left;a=a.touches[0].clientY-b.top}else c=a.offsetX,a=a.offsetY;this.highScoreBounds=this.getHighScoreBounds();return c>=this.highScoreBounds.x&&c<=this.highScoreBounds.x+this.highScoreBounds.width&&a>=this.highScoreBounds.y&&a<=this.highScoreBounds.y+this.highScoreBounds.height},getHighScoreBounds:function(){return{x:this.x-2*this.maxScoreUnits*DistanceMeter.dimensions.WIDTH-DistanceMeter.config.HIGH_SCORE_HIT_AREA_PADDING,y:this.y,width:DistanceMeter.dimensions.WIDTH*(this.highScore.length+1)+DistanceMeter.config.HIGH_SCORE_HIT_AREA_PADDING,height:DistanceMeter.dimensions.HEIGHT+2*DistanceMeter.config.HIGH_SCORE_HIT_AREA_PADDING}},flashHighScore:function(){var a=getTimeStamp(),b=a-(this.frameTimeStamp||a),c=!0;this.frameTimeStamp=a;this.flashIterations>2*this.config.FLASH_ITERATIONS?this.cancelHighScoreFlashing():(this.flashTimer+=b,this.flashTimer<this.config.FLASH_DURATION?c=!1:this.flashTimer>2*this.config.FLASH_DURATION&&(this.flashTimer=0,this.flashIterations++),c?this.drawHighScore():this.clearHighScoreBounds(),this.flashingRafId=requestAnimationFrame(this.flashHighScore.bind(this)))},clearHighScoreBounds:function(){this.canvasCtx.save();this.canvasCtx.fillStyle="#fff";this.canvasCtx.rect(this.highScoreBounds.x,this.highScoreBounds.y,this.highScoreBounds.width,this.highScoreBounds.height);this.canvasCtx.fill();this.canvasCtx.restore()},startHighScoreFlashing:function(){this.highScoreFlashing=!0;this.flashHighScore()},isHighScoreFlashing:function(){return this.highScoreFlashing},cancelHighScoreFlashing:function(){this.flashingRafId&&cancelAnimationFrame(this.flashingRafId);this.flashTimer=this.flashIterations=0;this.highScoreFlashing=!1;this.clearHighScoreBounds();this.drawHighScore()},resetHighScore:function(){this.setHighScore(0);this.cancelHighScoreFlashing()},reset:function(){this.update(0,0);this.achievement=!1}};function Cloud(a,b,c){this.canvas=a;this.canvasCtx=this.canvas.getContext("2d");this.spritePos=b;this.xPos=this.containerWidth=c;this.yPos=0;this.remove=!1;this.gap=getRandomNum(Cloud.config.MIN_CLOUD_GAP,Cloud.config.MAX_CLOUD_GAP);this.init()}Cloud.config={HEIGHT:14,MAX_CLOUD_GAP:400,MAX_SKY_LEVEL:30,MIN_CLOUD_GAP:100,MIN_SKY_LEVEL:71,WIDTH:46};Cloud.prototype={init:function(){this.yPos=getRandomNum(Cloud.config.MAX_SKY_LEVEL,Cloud.config.MIN_SKY_LEVEL);this.draw()},draw:function(){this.canvasCtx.save();var a=Cloud.config.WIDTH,b=Cloud.config.HEIGHT,c=a,d=b;IS_HIDPI&&(a*=2,b*=2);this.canvasCtx.drawImage(Runner.imageSprite,this.spritePos.x,this.spritePos.y,a,b,this.xPos,this.yPos,c,d);this.canvasCtx.restore()},update:function(a){this.remove||(this.xPos-=Math.ceil(a),this.draw(),this.isVisible()||(this.remove=!0))},isVisible:function(){return 0<this.xPos+Cloud.config.WIDTH}};function BackgroundEl(a,b,c,d){this.canvas=a;this.canvasCtx=this.canvas.getContext("2d");this.spritePos=b;this.xPos=this.containerWidth=c;this.yPos=0;this.remove=!1;this.type=d;this.gap=getRandomNum(BackgroundEl.config.MIN_GAP,BackgroundEl.config.MAX_GAP);this.animTimer=0;this.switchFrames=!1;this.spriteConfig={};this.init()}BackgroundEl.config={MAX_BG_ELS:0,MAX_GAP:0,MIN_GAP:0,POS:0,SPEED:0,Y_POS:0,MS_PER_FRAME:0};BackgroundEl.prototype={init:function(){this.spriteConfig=Runner.spriteDefinition.BACKGROUND_EL[this.type];this.spriteConfig.FIXED&&(this.xPos=this.spriteConfig.FIXED_X_POS);this.yPos=BackgroundEl.config.Y_POS-this.spriteConfig.HEIGHT+this.spriteConfig.OFFSET;this.draw()},draw:function(){this.canvasCtx.save();var a=this.spriteConfig.WIDTH,b=this.spriteConfig.HEIGHT,c=this.spriteConfig.X_POS,d=a,e=b;IS_HIDPI&&(a*=2,b*=2,c*=2);this.canvasCtx.drawImage(Runner.imageSprite,c,this.spritePos.y,a,b,this.xPos,this.yPos,d,e);this.canvasCtx.restore()},update:function(a){this.remove||(this.spriteConfig.FIXED?(this.animTimer+=a,this.animTimer>BackgroundEl.config.MS_PER_FRAME&&(this.animTimer=0,this.switchFrames=!this.switchFrames),this.spriteConfig.FIXED_Y_POS_1&&this.spriteConfig.FIXED_Y_POS_2&&(this.yPos=this.switchFrames?this.spriteConfig.FIXED_Y_POS_1:this.spriteConfig.FIXED_Y_POS_2)):this.xPos-=BackgroundEl.config.SPEED,this.draw(),this.isVisible()||(this.remove=!0))},isVisible:function(){return 0<this.xPos+this.spriteConfig.WIDTH}};function NightMode(a,b,c){this.spritePos=b;this.canvas=a;this.canvasCtx=a.getContext("2d");this.xPos=c-50;this.yPos=30;this.opacity=this.currentPhase=0;this.containerWidth=c;this.stars=[];this.drawStars=!1;this.placeStars()}NightMode.config={FADE_SPEED:.035,HEIGHT:40,MOON_SPEED:.25,NUM_STARS:2,STAR_SIZE:9,STAR_SPEED:.3,STAR_MAX_Y:70,WIDTH:20};NightMode.phases=[140,120,100,60,40,20,0];NightMode.prototype={update:function(a){a&&0===this.opacity&&(this.currentPhase++,this.currentPhase>=NightMode.phases.length&&(this.currentPhase=0));a&&(1>this.opacity||0===this.opacity)?this.opacity+=NightMode.config.FADE_SPEED:0<this.opacity&&(this.opacity-=NightMode.config.FADE_SPEED);if(0<this.opacity){this.xPos=this.updateXPos(this.xPos,NightMode.config.MOON_SPEED);if(this.drawStars)for(a=0;a<NightMode.config.NUM_STARS;a++)this.stars[a].x=this.updateXPos(this.stars[a].x,NightMode.config.STAR_SPEED);this.draw()}else this.opacity=0,this.placeStars();this.drawStars=!0},updateXPos:function(a,b){return a<-NightMode.config.WIDTH?this.containerWidth:a-b},draw:function(){var a=3===this.currentPhase?2*NightMode.config.WIDTH:NightMode.config.WIDTH,b=NightMode.config.HEIGHT,c=this.spritePos.x+NightMode.phases[this.currentPhase],d=a,e=NightMode.config.STAR_SIZE,f=Runner.spriteDefinitionByType.original.LDPI.STAR.x;IS_HIDPI&&(a*=2,b*=2,c=this.spritePos.x+2*NightMode.phases[this.currentPhase],e*=2,f=Runner.spriteDefinitionByType.original.HDPI.STAR.x);this.canvasCtx.save();this.canvasCtx.globalAlpha=this.opacity;if(this.drawStars)for(var g=0;g<NightMode.config.NUM_STARS;g++)this.canvasCtx.drawImage(Runner.origImageSprite,f,this.stars[g].sourceY,e,e,Math.round(this.stars[g].x),this.stars[g].y,NightMode.config.STAR_SIZE,NightMode.config.STAR_SIZE);this.canvasCtx.drawImage(Runner.origImageSprite,c,this.spritePos.y,a,b,Math.round(this.xPos),this.yPos,d,NightMode.config.HEIGHT);this.canvasCtx.globalAlpha=1;this.canvasCtx.restore()},placeStars:function(){for(var a=Math.round(this.containerWidth/NightMode.config.NUM_STARS),b=0;b<NightMode.config.NUM_STARS;b++)this.stars[b]={},this.stars[b].x=getRandomNum(a*b,a*(b+1)),this.stars[b].y=getRandomNum(0,NightMode.config.STAR_MAX_Y),this.stars[b].sourceY=IS_HIDPI?Runner.spriteDefinitionByType.original.HDPI.STAR.y+2*NightMode.config.STAR_SIZE*b:Runner.spriteDefinitionByType.original.LDPI.STAR.y+NightMode.config.STAR_SIZE*b},reset:function(){this.opacity=this.currentPhase=0;this.update(!1)}};function HorizonLine(a,b){var c=b.SOURCE_X,d=b.SOURCE_Y;IS_HIDPI&&(c*=2,d*=2);this.spritePos={x:c,y:d};this.canvas=a;this.canvasCtx=a.getContext("2d");this.sourceDimensions={};this.dimensions=b;this.sourceXPos=[this.spritePos.x,this.spritePos.x+this.dimensions.WIDTH];this.xPos=[];this.yPos=0;this.bumpThreshold=.5;this.setSourceDimensions(b);this.draw()}HorizonLine.dimensions={WIDTH:600,HEIGHT:12,YPOS:127};HorizonLine.prototype={setSourceDimensions:function(a){for(var b in a)"SOURCE_X"!==b&&"SOURCE_Y"!==b&&(IS_HIDPI?"YPOS"!==b&&(this.sourceDimensions[b]=2*a[b]):this.sourceDimensions[b]=a[b],this.dimensions[b]=a[b]);this.xPos=[0,a.WIDTH];this.yPos=a.YPOS},getRandomType:function(){return Math.random()>this.bumpThreshold?this.dimensions.WIDTH:0},draw:function(){this.canvasCtx.drawImage(Runner.imageSprite,this.sourceXPos[0],this.spritePos.y,this.sourceDimensions.WIDTH,this.sourceDimensions.HEIGHT,this.xPos[0],this.yPos,this.dimensions.WIDTH,this.dimensions.HEIGHT);this.canvasCtx.drawImage(Runner.imageSprite,this.sourceXPos[1],this.spritePos.y,this.sourceDimensions.WIDTH,this.sourceDimensions.HEIGHT,this.xPos[1],this.yPos,this.dimensions.WIDTH,this.dimensions.HEIGHT)},updateXPos:function(a,b){var c=0===a?1:0;this.xPos[a]-=b;this.xPos[c]=this.xPos[a]+this.dimensions.WIDTH;this.xPos[a]<=-this.dimensions.WIDTH&&(this.xPos[a]+=2*this.dimensions.WIDTH,this.xPos[c]=this.xPos[a]-this.dimensions.WIDTH,this.sourceXPos[a]=this.getRandomType()+this.spritePos.x)},update:function(a,b){a=Math.floor(FPS/1E3*b*a);0>=this.xPos[0]?this.updateXPos(0,a):this.updateXPos(1,a);this.draw()},reset:function(){this.xPos[0]=0;this.xPos[1]=this.dimensions.WIDTH}};function Horizon(a,b,c,d){this.canvas=a;this.canvasCtx=this.canvas.getContext("2d");this.config=Horizon.config;this.dimensions=c;this.gapCoefficient=d;this.obstacles=[];this.obstacleHistory=[];this.horizonOffsets=[0,0];this.cloudFrequency=this.config.CLOUD_FREQUENCY;this.spritePos=b;this.nightMode=null;this.altGameModeActive=!1;this.clouds=[];this.cloudSpeed=this.config.BG_CLOUD_SPEED;this.backgroundEls=[];this.lastEl=null;this.backgroundSpeed=this.config.BG_CLOUD_SPEED;this.horizonLine=null;this.horizonLines=[];this.init()}Horizon.config={BG_CLOUD_SPEED:.2,BUMPY_THRESHOLD:.3,CLOUD_FREQUENCY:.5,HORIZON_HEIGHT:16,MAX_CLOUDS:6};Horizon.prototype={init:function(){Obstacle.types=Runner.spriteDefinitionByType.original.OBSTACLES;this.addCloud();for(var a=0;a<Runner.spriteDefinition.LINES.length;a++)this.horizonLines.push(new HorizonLine(this.canvas,Runner.spriteDefinition.LINES[a]));this.nightMode=new NightMode(this.canvas,this.spritePos.MOON,this.dimensions.WIDTH)},adjustObstacleSpeed:function(){for(var a=0;a<Obstacle.types.length;a++)Runner.slowDown&&(Obstacle.types[a].multipleSpeed/=2,Obstacle.types[a].minGap*=1.5,Obstacle.types[a].minSpeed/=2,"object"==typeof Obstacle.types[a].yPos&&(Obstacle.types[a].yPos=Obstacle.types[a].yPos[0],Obstacle.types[a].yPosMobile=Obstacle.types[a].yPos[0]))},enableAltGameMode:function(a){this.clouds=[];this.backgroundEls=[];this.altGameModeActive=!0;this.spritePos=a;Obstacle.types=Runner.spriteDefinition.OBSTACLES;this.adjustObstacleSpeed();Obstacle.MAX_GAP_COEFFICIENT=Runner.spriteDefinition.MAX_GAP_COEFFICIENT;Obstacle.MAX_OBSTACLE_LENGTH=Runner.spriteDefinition.MAX_OBSTACLE_LENGTH;BackgroundEl.config=Runner.spriteDefinition.BACKGROUND_EL_CONFIG;this.horizonLines=[];for(a=0;a<Runner.spriteDefinition.LINES.length;a++)this.horizonLines.push(new HorizonLine(this.canvas,Runner.spriteDefinition.LINES[a]));this.reset()},update:function(a,b,c,d){this.runningTime+=a;this.altGameModeActive&&this.updateBackgroundEls(a,b);for(var e=0;e<this.horizonLines.length;e++)this.horizonLines[e].update(a,b);if(!this.altGameModeActive||Runner.spriteDefinition.HAS_CLOUDS)this.nightMode.update(d),this.updateClouds(a,b);c&&this.updateObstacles(a,b)},updateBackgroundEl:function(a,b,c,d,e){var f=b.length;if(f){for(var g=f-1;0<=g;g--)b[g].update(a);a=b[f-1];f<c&&this.dimensions.WIDTH-a.xPos>a.gap&&e>Math.random()&&d()}else d()},updateClouds:function(a,b){this.updateBackgroundEl(this.cloudSpeed/1E3*a*b,this.clouds,this.config.MAX_CLOUDS,this.addCloud.bind(this),this.cloudFrequency);this.clouds=this.clouds.filter(function(c){return!c.remove})},updateBackgroundEls:function(a,b){this.updateBackgroundEl(a,this.backgroundEls,BackgroundEl.config.MAX_BG_ELS,this.addBackgroundEl.bind(this),this.cloudFrequency);this.backgroundEls=this.backgroundEls.filter(function(c){return!c.remove})},updateObstacles:function(a,b){for(var c=this.obstacles.slice(0),d=0;d<this.obstacles.length;d++){var e=this.obstacles[d];e.update(a,b);e.remove&&c.shift()}this.obstacles=c;0<this.obstacles.length?(a=this.obstacles[this.obstacles.length-1])&&!a.followingObstacleCreated&&a.isVisible()&&a.xPos+a.width+a.gap<this.dimensions.WIDTH&&(this.addNewObstacle(b),a.followingObstacleCreated=!0):this.addNewObstacle(b)},removeFirstObstacle:function(){this.obstacles.shift()},addNewObstacle:function(a){var b="COLLECTABLE"!=Obstacle.types[Obstacle.types.length-1].type||Runner.isAltGameModeEnabled()&&!this.altGameModeActive||this.altGameModeActive?Obstacle.types.length-1:Obstacle.types.length-2,c=0<b?getRandomNum(0,b):0;c=Obstacle.types[c];0<b&&this.duplicateObstacleCheck(c.type)||a<c.minSpeed?this.addNewObstacle(a):(this.obstacles.push(new Obstacle(this.canvasCtx,c,this.spritePos[c.type],this.dimensions,this.gapCoefficient,a,c.width,this.altGameModeActive)),this.obstacleHistory.unshift(c.type),1<this.obstacleHistory.length&&this.obstacleHistory.splice(Runner.config.MAX_OBSTACLE_DUPLICATION))},duplicateObstacleCheck:function(a){for(var b=0,c=0;c<this.obstacleHistory.length;c++)b=this.obstacleHistory[c]===a?b+1:0;return b>=Runner.config.MAX_OBSTACLE_DUPLICATION},reset:function(){this.obstacles=[];for(var a=0;a<this.horizonLines.length;a++)this.horizonLines[a].reset();this.nightMode.reset()},resize:function(a,b){this.canvas.width=a;this.canvas.height=b},addCloud:function(){this.clouds.push(new Cloud(this.canvas,this.spritePos.CLOUD,this.dimensions.WIDTH))},addBackgroundEl:function(){var a=Object.keys(Runner.spriteDefinition.BACKGROUND_EL);if(0<a.length){var b=getRandomNum(0,a.length-1);for(b=a[b];b==this.lastEl&&1<a.length;)b=getRandomNum(0,a.length-1),b=a[b];this.lastEl=b;this.backgroundEls.push(new BackgroundEl(this.canvas,this.spritePos.BACKGROUND_EL,this.dimensions.WIDTH,b))}}};